# pico2w-bootloader-rs (Pico 2 W Rust Bootloader)

Raspberry Pi Pico 2 W (RP2350)를 위한 안전하고 견고한 Rust 기반 부트로더입니다.

## 주요 기능

- **무결성 검증 (CRC32)**: 애플리케이션의 매직 넘버("APPS")와 전체 이미지의 CRC32 체크섬을 검증하여 안전한 부팅을 보장합니다.
- **자동 DFU 모드 진입**: 애플리케이션이 없거나 체크섬이 손상된 경우 자동으로 업데이트 모드로 진입합니다.
- **UART DFU (Device Firmware Update)**: 시리얼 통신(UART)을 통해 새로운 펌웨어를 업로드할 수 있습니다.
- **안전한 부팅 (Safe Jump)**: `VTOR` 설정 및 스택 포인터 검증을 통해 애플리케이션으로 안전하게 점프합니다.

## 메모리 레이아웃

- **Bootloader (64KB)**: `0x10000000` ~ `0x1000FFFF`
- **Metadata (256B)**: `0x10010000` ~ `0x100100FF` (Magic, Length, CRC32 포함)
- **Application**: `0x10010100` ~

## UART DFU 프로토콜

업데이트 모드에서 사용되는 프로토콜 사양:
- **Baudrate**: 115200 bps
1. **진입 시그널**: `'u'` 키 (전원 투입 후 3초 이내 입력 시 수동 진입, 또는 원격 리셋 후 자동 진입 가능)
2. **매직 바이트**: `0xAA`
3. **헤더 (8 bytes)**: `[Length (4B, LE) | CRC32 (4B, LE)]`
4. **데이터**: 애플리케이션 바이너리 (`Length` 만큼 전송)

## 빌드 및 실행

```bash
# 빌드 및 플래싱
cargo run --release
```

## 시스템 연동 (원격 업데이트)

이 부트로더는 `pico2w-downloader-rs` 유틸리티와 함께 사용하여 원격 업데이트를 수행할 수 있습니다.
1. `pico2w-shell-rs` 실행 중 `reboot` 명령을 보내면 부트로더가 재시작됩니다.
2. 부트로더는 대기 중인 다운로더로부터 `'u'` 신호를 받아 DFU 모드로 전환됩니다.
3. 새로운 이미지를 플래싱하고 검증 후 다시 실행합니다.
